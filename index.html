<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</title>

<style>
*{box-sizing:border-box;font-family:sans-serif}
body{margin:0;background:#ffb6d9;min-height:100vh;padding:20px 60px 80px 20px}
h2{text-align:center;color:#fff}
.top{display:flex;gap:10px;margin-bottom:15px}
input,button{padding:10px;border-radius:10px;border:none;font-weight:bold}
button{background:#ff4d94;color:#fff;cursor:pointer}
.room-list{display:flex;flex-direction:column;gap:12px}
.room{background:#fff;border-radius:12px;padding:12px;box-shadow:0 4px 10px rgba(0,0,0,.2);cursor:pointer}
.hidden{display:none}
.container{max-width:900px;margin:auto}
.room-header{display:flex;justify-content:space-between;align-items:center;background:#1c1c1c;padding:10px 15px;border-radius:10px;color:#fff}
.owner-controls button{background:#00ff99;color:#000;margin-left:5px}
.camera-area{margin-top:15px;background:#000;border-radius:12px;height:220px;display:none;align-items:center;justify-content:center}
.camera-area video{width:100%;height:100%;object-fit:cover;border-radius:12px}
.chat-box{margin-top:10px;background:#1c1c1c;border-radius:10px;padding:10px;height:200px;overflow-y:auto;color:#fff;display:flex;flex-direction:column-reverse}
.chat-input{display:flex;margin-top:10px;gap:10px}
.chat-input input{flex:1}

#bottomNav{
    position:fixed;
    bottom:0;
    left:0;
    width:100%;
    background:#ff4d94;
    display:flex;
    justify-content:space-around;
    padding:10px 0;
    border-top-left-radius:12px;
    border-top-right-radius:12px;
    box-shadow:0 -3px 10px rgba(0,0,0,0.2);
}
#bottomNav button{
    flex:1;
    color:#fff;
    font-weight:bold;
    background:none;
    border:none;
    cursor:pointer;
}
</style>
</head>

<body>

<h2>‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á</h2>

<div id="listBox">
    <div class="top">
        <input id="search" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ID ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á">
        <button onclick="renderRooms()">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
        <button onclick="showOpen()">‚ûï ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡πâ‡∏≠‡∏á</button>
    </div>
    <div id="roomList" class="room-list"></div>
</div>

<div id="openBox" class="hidden">
    <input id="roomName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á">
    <input id="roomId" placeholder="ID ‡∏´‡πâ‡∏≠‡∏á (8 ‡∏ï‡∏±‡∏ß)">
    <button onclick="setLock(false)">üîì ‡πÑ‡∏°‡πà‡∏•‡πá‡∏≠‡∏Ñ</button>
    <button onclick="setLock(true)">üîí ‡∏•‡πá‡∏≠‡∏Ñ</button>
    <input id="roomPass" class="hidden" placeholder="‡∏£‡∏´‡∏±‡∏™ 6 ‡∏ï‡∏±‡∏ß">
    <button onclick="openRoom()">‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡πâ‡∏≠‡∏á</button>
    <button onclick="back()">‚¨Ö ‡∏Å‡∏•‡∏±‡∏ö</button>
</div>

<div id="roomBox" class="hidden container">
    <div class="room-header">
        <div>
            <b id="showRoomName"></b>
            <div style="font-size:13px;color:#aaa">
                ID ‡∏´‡πâ‡∏≠‡∏á: <span id="showRoomId"></span> | üë• <span id="showRoomCount">0</span> ‡∏Ñ‡∏ô
            </div>
        </div>

        <div id="ownerControls" class="owner-controls hidden">
            <button onclick="toggleCam()">üé• ‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
            <button onclick="closeRoom()">‚ùå ‡∏õ‡∏¥‡∏î‡∏´‡πâ‡∏≠‡∏á</button>
        </div>
    </div>

    <div id="cameraArea" class="camera-area">
        <video id="cameraVideo" autoplay playsinline></video>
    </div>

    <div id="chatBox" class="chat-box"></div>

    <div class="chat-input">
        <input id="chatInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°...">
        <button onclick="sendChat()">‡∏™‡πà‡∏á</button>
        <button onclick="exitRoom()">‡∏≠‡∏≠‡∏Å</button>
    </div>
</div>

<div id="bottomNav">
    <button onclick="showPage('home')">üè† ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
    <button onclick="showPage('chat')">üí¨ ‡πÅ‡∏ä‡∏ó</button>
    <button onclick="showPage('account')">üë§ ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</button>
</div>

<script>
let locked=false;
let currentRoomId=null;
let camOn=false;
let cameraStream=null;
let username=localStorage.getItem("username");
if(!username){
    username=prompt("‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì");
    localStorage.setItem("username",username);
}

const roomList=document.getElementById("roomList");
const search=document.getElementById("search");

// ===== RENDER ROOM LIST =====
function renderRooms(){
    const rooms=JSON.parse(localStorage.getItem("rooms")||"[]");
    const filter = search.value.trim().toLowerCase();
    roomList.innerHTML="";
    rooms.filter(r=>{
        return r.name.toLowerCase().includes(filter) || r.id.toLowerCase().includes(filter)
    }).forEach(r=>{
        const d=document.createElement("div");
        d.className="room";
        d.innerHTML=`<b>${r.name}</b><br>
        <small>ID: ${r.id} | üë• ${r.users.length} ‡∏Ñ‡∏ô | ${r.locked?"üîí ‡∏•‡πá‡∏≠‡∏Ñ":"üîì ‡πÑ‡∏°‡πà‡∏•‡πá‡∏≠‡∏Ñ"}</small>`;
        d.onclick=()=>enterRoom(r.id);
        roomList.appendChild(d);
    });
}
search.oninput=renderRooms;

// ===== OPEN ROOM =====
function showOpen(){
    listBox.classList.add("hidden");
    openBox.classList.remove("hidden");
}
function back(){
    openBox.classList.add("hidden");
    listBox.classList.remove("hidden");
}
function setLock(l){
    locked=l;
    roomPass.classList.toggle("hidden",!l);
}

// ===== CREATE ROOM (‡πÄ‡∏ä‡πá‡∏Å ID ‡∏ã‡πâ‡∏≥) =====
function openRoom(){
    const name = roomName.value.trim();
    const id = roomId.value.trim();
    const pass = roomPass.value.trim();

    if(!name || id.length !== 8) return alert("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
    if(locked && pass.length !== 6) return alert("‡∏£‡∏´‡∏±‡∏™‡∏ï‡πâ‡∏≠‡∏á 6 ‡∏ï‡∏±‡∏ß");

    let rooms = JSON.parse(localStorage.getItem("rooms") || "[]");

    // ===== ‡πÄ‡∏ä‡πá‡∏Å ID ‡∏ã‡πâ‡∏≥ =====
    if(rooms.some(r => r.id === id)){
        return alert("ID ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ ID ‡∏≠‡∏∑‡πà‡∏ô");
    }

    rooms.push({
        id,
        name,
        locked,
        password: locked ? pass : "",
        owner: username,
        users: [username],
        chats: []
    });
    localStorage.setItem("rooms", JSON.stringify(rooms));
    renderRooms();
    enterRoom(id);
}

// ===== ENTER ROOM =====
function enterRoom(id){
    let rooms=JSON.parse(localStorage.getItem("rooms")||"[]");
    const room=rooms.find(r=>r.id===id);
    if(!room) return;
    if(room.locked){
        const p=prompt("‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á");
        if(p!==room.password) return alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î");
    }
    if(!room.users.includes(username)) room.users.push(username);
    localStorage.setItem("rooms",JSON.stringify(rooms));
    currentRoomId=id;

    listBox.classList.add("hidden");
    openBox.classList.add("hidden");
    roomBox.classList.remove("hidden");

    showRoomName.innerText=room.name+(room.locked?" üîí":"");
    showRoomId.innerText=room.id;
    showRoomCount.innerText=room.users.length;
    ownerControls.classList.toggle("hidden",room.owner!==username);

    renderChat();
}

// ===== CHAT =====
function sendChat(){
    if(!chatInput.value) return;
    let rooms=JSON.parse(localStorage.getItem("rooms")||"[]");
    const room=rooms.find(r=>r.id===currentRoomId);
    room.chats.push(username+": "+chatInput.value);
    if(room.chats.length>5) room.chats.shift();
    localStorage.setItem("rooms",JSON.stringify(rooms));
    renderChat();
    chatInput.value="";
}
function renderChat(){
    let rooms=JSON.parse(localStorage.getItem("rooms")||"[]");
    const room=rooms.find(r=>r.id===currentRoomId);
    chatBox.innerHTML="";
    room.chats.slice().reverse().forEach(c=>{
        const d=document.createElement("div");
        d.innerText=c;
        chatBox.appendChild(d);
    });
    showRoomCount.innerText=room.users.length;
}

// ===== CAM =====
function toggleCam(){
    if(!camOn){
        navigator.mediaDevices.getUserMedia({video:true})
        .then(s=>{
            cameraStream=s;
            cameraVideo.srcObject=s;
            cameraArea.style.display="flex";
            camOn=true;
        });
    }else{
        cameraStream.getTracks().forEach(t=>t.stop());
        cameraVideo.srcObject=null;
        cameraArea.style.display="none";
        camOn=false;
    }
}

// ===== CLOSE ROOM =====
function closeRoom(){
    if(!confirm("‡∏õ‡∏¥‡∏î‡∏´‡πâ‡∏≠‡∏á?")) return;
    let rooms=JSON.parse(localStorage.getItem("rooms")||"[]");
    rooms=rooms.filter(r=>r.id!==currentRoomId);
    localStorage.setItem("rooms",JSON.stringify(rooms));
    currentRoomId=null;
    roomBox.classList.add("hidden");
    listBox.classList.remove("hidden");
    renderRooms();
}

// ===== EXIT ROOM =====
function exitRoom(){
    if(cameraStream) cameraStream.getTracks().forEach(t=>t.stop());
    camOn=false;
    let rooms=JSON.parse(localStorage.getItem("rooms")||"[]");
    const room=rooms.find(r=>r.id===currentRoomId);
    if(room) room.users=room.users.filter(u=>u!==username);
    localStorage.setItem("rooms",JSON.stringify(rooms));
    currentRoomId=null;
    roomBox.classList.add("hidden");
    listBox.classList.remove("hidden");
    renderRooms();
}

// ===== BOTTOM NAV FUNCTION =====
function showPage(page){
    const listBox=document.getElementById("listBox");
    const roomBox=document.getElementById("roomBox");
    const openBox=document.getElementById("openBox");

    if(page==="home"){
        listBox.classList.remove("hidden");
        roomBox.classList.add("hidden");
        openBox.classList.add("hidden");
    } else if(page==="chat"){
        alert("‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ä‡∏ó‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÅ‡∏¢‡∏Å (‡πÄ‡∏Ç‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ)");
    } else if(page==="account"){
        alert("‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: "+username);
    }
}

renderRooms();
</script>

</body>
  </html>
